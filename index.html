<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1920, height=1080">
<title>ISH - Building Tomorrow's Legacy Today</title>

<!-- WhatsApp / OG Share Tags -->
<meta property="og:title" content="Isgcawu Somnotho Holdings - We Build Legacy">
<meta property="og:description" content="R245M+ Project Experience | Level 1 B-BBEE | 100% Black Owned | Residential, Commercial, Mining, Rail & General Construction">
<meta property="og:image" content="https://bakiel.github.io/ish-video-ad/og-share.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://bakiel.github.io/ish-video-ad/">
<meta property="og:type" content="video.other">
<meta property="og:site_name" content="Isgcawu Somnotho Holdings">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ISH - We Don't Just Build. We Build Legacy.">
<meta name="twitter:description" content="R245M+ Project Experience | Level 1 B-BBEE | 100% Black Owned | 51% Women Owned">
<meta name="twitter:image" content="https://bakiel.github.io/ish-video-ad/og-share.png">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:'Source Sans 3',sans-serif;display:flex;align-items:center;justify-content:center}
.viewport{width:1920px;height:1080px;position:relative;overflow:hidden;background:#0D2137;transform-origin:center center}

.scene{position:absolute;inset:0;opacity:0;pointer-events:none;display:flex;align-items:center;justify-content:center;overflow:hidden}
.scene.active{pointer-events:auto}
.scene-bg{position:absolute;inset:-40px;background-size:cover;background-position:center;filter:brightness(0.35);will-change:transform}
.scene-overlay{position:absolute;inset:0;z-index:1}
.scene-content{position:relative;z-index:2;text-align:center;padding:0 120px;width:100%}

.serif{font-family:'Playfair Display',Georgia,serif}
.sans{font-family:'Source Sans 3','Segoe UI',sans-serif}
.gold{color:#D4A853}
.white{color:#FFFFFF}
.light{color:rgba(255,255,255,0.7)}

.letterbox-top,.letterbox-bottom{position:absolute;left:0;right:0;height:60px;background:#000;z-index:100}
.letterbox-top{top:0}
.letterbox-bottom{bottom:0}
.progress-bar{position:absolute;bottom:60px;left:0;height:3px;background:linear-gradient(90deg,#D4A853,#E8C878);z-index:101;transition:width 0.1s linear}

.crown-logo{display:inline-block;position:relative}

/* Dust particles canvas layers */
#dustFar,#dustNear{position:absolute;inset:0;pointer-events:none}
#dustFar{z-index:3;opacity:0.4}
#dustNear{z-index:51;opacity:0.7}

.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:40px;max-width:1400px;margin:0 auto}
.stat-card{text-align:center;padding:30px 20px;border:1px solid rgba(212,168,83,0.3);border-radius:8px;background:rgba(13,33,55,0.6);backdrop-filter:blur(10px)}
.stat-value{font-size:56px;font-weight:800;line-height:1.1;margin-bottom:8px}
.stat-label{font-size:18px;font-weight:400;text-transform:uppercase;letter-spacing:3px}

.services-row{display:flex;gap:24px;justify-content:center;flex-wrap:nowrap;max-width:1600px;margin:0 auto}
.service-card{flex:1;max-width:280px;padding:28px 20px;text-align:center;border:1px solid rgba(212,168,83,0.25);border-radius:8px;background:rgba(13,33,55,0.5);backdrop-filter:blur(8px)}
.service-icon{width:48px;height:48px;margin:0 auto 16px;border-radius:50%;background:rgba(212,168,83,0.15);display:flex;align-items:center;justify-content:center}
.service-icon svg{width:24px;height:24px;stroke:#D4A853;fill:none;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round}
.service-name{font-size:20px;font-weight:600;margin-bottom:6px}

.controls{position:absolute;bottom:80px;right:40px;z-index:102;display:flex;gap:12px;align-items:center}
.controls span{color:rgba(255,255,255,0.4);font-size:13px;letter-spacing:1px;text-transform:uppercase}
.play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:200;width:80px;height:80px;border-radius:50%;background:rgba(212,168,83,0.9);display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;pointer-events:none;transition:opacity 0.3s}
.play-btn.show{opacity:1;pointer-events:auto}
.play-btn svg{width:32px;height:32px;fill:#0D2137;margin-left:4px}
.gold-line{width:80px;height:2px;background:linear-gradient(90deg,transparent,#D4A853,transparent);margin:20px auto}

.cta-item{display:flex;align-items:center;gap:12px}
.cta-item svg{width:20px;height:20px;stroke:#D4A853;fill:none;stroke-width:1.5}
.cta-item span{font-size:18px;font-weight:500;color:rgba(255,255,255,0.9);letter-spacing:0.5px}

.fade-up{opacity:0;transform:translateY(40px)}
.fade-in{opacity:0}
</style>
</head>
<body>
<div class="viewport" id="viewport">

  <!-- Two-layer dust for depth -->
  <canvas id="dustFar" width="1920" height="1080"></canvas>
  <canvas id="dustNear" width="1920" height="1080"></canvas>

  <!-- Scene 1: Logo Reveal (0-4.5s) — Preloader-style build -->
  <div class="scene" id="scene1">
    <div class="scene-overlay" style="background:radial-gradient(ellipse at center,rgba(13,33,55,0.3) 0%,#0D2137 70%)"></div>
    <div class="scene-content">
      <div class="crown-logo" id="crownBuild">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 620 510" width="180" height="147" id="crownSvg1">
          <!-- Build order: base(10) → lower(7-9) → tower-white(3) → tower-gold(4-6) → wings(1-2) -->
          <!-- Each piece gets data-build-order (lower = earlier) -->
          <polygon data-build="0" data-type="dark" fill="#ffffff" points="516.5 477.5 500.5 476.5 469.5 473.5 363.5 473.5 258.5 473.5 153.5 473.5 107.5 477.5 104.5 479.5 104.5 509.5 517.5 509.5 517.5 502.5 517.5 484.5 516.5 477.5"/>
          <polygon data-build="1" data-type="dark" fill="#ffffff" points="256.5 457.5 302.5 457.5 302.5 308.44 256.5 344.29 256.5 457.5"/>
          <polygon data-build="2" data-type="dark" fill="#ffffff" points="188.5 458.5 243.5 457.5 243.5 354.42 188.5 397.29 188.5 458.5"/>
          <polygon data-build="3" data-type="dark" fill="#ffffff" points="308.5 457.5 363.5 457.5 363.5 260.9 308.5 303.77 308.5 457.5"/>
          <polygon data-build="4" data-type="dark" fill="#ffffff" points="376.5 457.5 431.5 458.5 431.5 207.91 376.5 250.77 376.5 457.5"/>
          <polygon data-build="5" data-type="gold" fill="#D4A853" points="243.5 344.89 243.5 117.5 240.5 119.5 188.5 181.5 188.5 387.76 243.5 344.89"/>
          <path data-build="6" data-type="gold" fill="#D4A853" d="M433.5,181.5c-16-19-33-38-50-57-2-3-4-5-5-8l-2,2v122.74l57-44.42v-15.31h0Z"/>
          <path data-build="7" data-type="gold" fill="#D4A853" d="M305.5,56.22c.9-.46,1.92-.72,3-.72s2.1.26,3,.72v235.67l52-40.53V99.5L310.5.5l-54,100v234.26l49-38.19V56.22Z"/>
          <polygon data-build="8" data-type="dark" fill="#ffffff" points="172.5 459.5 172.5 457.5 83.5 257.5 172.5 297.5 172.5 263.5 .5 183.5 109.5 463.5 172.5 459.5"/>
          <polygon data-build="9" data-type="dark" fill="#ffffff" points="514.5 464.5 619.5 184.5 448.5 263.5 448.5 296.5 537.5 257.5 449.5 458.5 514.5 464.5"/>
        </svg>
      </div>
      <div class="gold-line fade-in" data-anim="fadeIn" data-delay="2.4" data-dur="0.5" style="margin:24px auto"></div>
      <h1 class="serif white fade-up" data-anim="fadeUp" data-delay="2.6" data-dur="0.8" style="font-size:28px;font-weight:500;letter-spacing:8px;text-transform:uppercase">Isgcawu Somnotho Holdings</h1>
      <p class="sans gold fade-up" data-anim="fadeUp" data-delay="3.0" data-dur="0.6" style="font-size:16px;letter-spacing:4px;text-transform:uppercase;margin-top:12px;font-weight:400">Building Tomorrow's Legacy Today</p>
    </div>
  </div>

  <!-- Scene 2: Hook -->
  <div class="scene" id="scene2">
    <div class="scene-bg" id="bg2" style="background-image:url('images/construction/hero_crane_site.jpg')"></div>
    <div class="scene-overlay" style="background:linear-gradient(to right,rgba(13,33,55,0.85) 0%,rgba(13,33,55,0.4) 50%,rgba(0,0,0,0.3) 100%)"></div>
    <div class="scene-content" style="text-align:left;padding-left:140px;max-width:900px">
      <p class="sans gold fade-up" data-anim="fadeUp" data-delay="0.3" data-dur="0.6" style="font-size:18px;letter-spacing:4px;text-transform:uppercase;font-weight:500;margin-bottom:20px">Since 2015</p>
      <h1 class="serif white fade-up" data-anim="fadeUp" data-delay="0.6" data-dur="0.8" style="font-size:72px;font-weight:700;line-height:1.1">We Don't Just<br>Build Structures.</h1>
    </div>
  </div>

  <!-- Scene 3: Pivot -->
  <div class="scene" id="scene3">
    <div class="scene-bg" id="bg3" style="background-image:url('images/construction/hero_sunset_crane.jpg')"></div>
    <div class="scene-overlay" style="background:linear-gradient(to top,rgba(13,33,55,0.9) 0%,rgba(13,33,55,0.3) 40%,rgba(0,0,0,0.2) 100%)"></div>
    <div class="scene-content" style="padding-top:200px">
      <h1 class="serif gold fade-up" data-anim="fadeUp" data-delay="0.2" data-dur="1.0" style="font-size:96px;font-weight:800;line-height:1;text-shadow:0 4px 40px rgba(0,0,0,0.5)">We Build Legacy.</h1>
      <div class="gold-line fade-in" data-anim="fadeIn" data-delay="1.0" data-dur="0.6" style="margin:30px auto;width:120px"></div>
      <p class="sans white fade-up" data-anim="fadeUp" data-delay="1.2" data-dur="0.8" style="font-size:24px;font-weight:300;max-width:600px;margin:0 auto;line-height:1.6;opacity:0.85">Residential. Commercial. Mining.<br>Rail. General Construction.</p>
    </div>
  </div>

  <!-- Scene 4: Stats -->
  <div class="scene" id="scene4">
    <div class="scene-bg" id="bg4" style="background-image:url('images/construction/crane_skyline.jpg')"></div>
    <div class="scene-overlay" style="background:linear-gradient(135deg,rgba(13,33,55,0.92) 0%,rgba(13,33,55,0.75) 100%)"></div>
    <div class="scene-content">
      <p class="sans gold fade-up" data-anim="fadeUp" data-delay="0.2" data-dur="0.5" style="font-size:16px;letter-spacing:5px;text-transform:uppercase;margin-bottom:40px;font-weight:500">By The Numbers</p>
      <div class="stats-grid">
        <div class="stat-card fade-up" data-anim="fadeUp" data-delay="0.4" data-dur="0.6">
          <div class="stat-value serif gold" data-counter="245" data-prefix="R" data-suffix="M+">R0M+</div>
          <div class="stat-label sans light">Project Experience</div>
        </div>
        <div class="stat-card fade-up" data-anim="fadeUp" data-delay="0.6" data-dur="0.6">
          <div class="stat-value serif gold" style="font-size:48px">Level 1</div>
          <div class="stat-label sans light">B-BBEE Rating</div>
        </div>
        <div class="stat-card fade-up" data-anim="fadeUp" data-delay="0.8" data-dur="0.6">
          <div class="stat-value serif gold" data-counter="100" data-suffix="%">0%</div>
          <div class="stat-label sans light">Black Owned</div>
        </div>
        <div class="stat-card fade-up" data-anim="fadeUp" data-delay="1.0" data-dur="0.6">
          <div class="stat-value serif gold" data-counter="51" data-suffix="%">0%</div>
          <div class="stat-label sans light">Women Owned</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scene 5: Services -->
  <div class="scene" id="scene5">
    <div class="scene-bg" id="bg5" style="background-image:url('images/construction/commercial_building.jpg')"></div>
    <div class="scene-overlay" style="background:linear-gradient(to bottom,rgba(13,33,55,0.88) 0%,rgba(13,33,55,0.7) 100%)"></div>
    <div class="scene-content">
      <p class="sans gold fade-up" data-anim="fadeUp" data-delay="0.2" data-dur="0.5" style="font-size:16px;letter-spacing:5px;text-transform:uppercase;margin-bottom:16px;font-weight:500">Our Expertise</p>
      <h2 class="serif white fade-up" data-anim="fadeUp" data-delay="0.4" data-dur="0.6" style="font-size:48px;font-weight:700;margin-bottom:40px">Five Pillars of Construction</h2>
      <div class="services-row">
        <div class="service-card fade-up" data-anim="fadeUp" data-delay="0.6" data-dur="0.5">
          <div class="service-icon"><svg viewBox="0 0 24 24"><path d="M3 21h18M5 21V7l7-4 7 4v14M9 21v-6h6v6"/></svg></div>
          <div class="service-name sans white">Residential</div>
        </div>
        <div class="service-card fade-up" data-anim="fadeUp" data-delay="0.75" data-dur="0.5">
          <div class="service-icon"><svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M8 10h.01M16 10h.01M12 10h.01M8 14h.01M16 14h.01M12 14h.01"/></svg></div>
          <div class="service-name sans white">Commercial</div>
        </div>
        <div class="service-card fade-up" data-anim="fadeUp" data-delay="0.9" data-dur="0.5">
          <div class="service-icon"><svg viewBox="0 0 24 24"><path d="M2 20h20M6 20V8l4-4h4l4 4v12M10 14h4M10 10h4"/><circle cx="12" cy="6" r="1"/></svg></div>
          <div class="service-name sans white">Mining</div>
        </div>
        <div class="service-card fade-up" data-anim="fadeUp" data-delay="1.05" data-dur="0.5">
          <div class="service-icon"><svg viewBox="0 0 24 24"><path d="M2 17h20M6 17v-4M10 17v-4M14 17v-4M18 17v-4"/><path d="M4 13h16M2 9h20"/></svg></div>
          <div class="service-name sans white">Rail Works</div>
        </div>
        <div class="service-card fade-up" data-anim="fadeUp" data-delay="1.2" data-dur="0.5">
          <div class="service-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
          <div class="service-name sans white">General</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scene 6: Leadership -->
  <div class="scene" id="scene6">
    <div class="scene-bg" id="bg6" style="background-image:url('images/people/executive_man_marble_lobby.png')"></div>
    <div class="scene-overlay" style="background:linear-gradient(to right,rgba(13,33,55,0.9) 0%,rgba(13,33,55,0.5) 60%,rgba(0,0,0,0.3) 100%)"></div>
    <div class="scene-content" style="text-align:left;padding-left:140px;max-width:800px">
      <p class="sans gold fade-up" data-anim="fadeUp" data-delay="0.2" data-dur="0.5" style="font-size:16px;letter-spacing:4px;text-transform:uppercase;font-weight:500;margin-bottom:16px">Leadership</p>
      <h2 class="serif white fade-up" data-anim="fadeUp" data-delay="0.5" data-dur="0.8" style="font-size:60px;font-weight:700;line-height:1.15;margin-bottom:16px">Ronald Radebe</h2>
      <div class="gold-line fade-in" data-anim="fadeIn" data-delay="1.0" data-dur="0.5" style="margin:0;margin-bottom:20px"></div>
      <p class="sans white fade-up" data-anim="fadeUp" data-delay="1.1" data-dur="0.6" style="font-size:22px;font-weight:300;line-height:1.6;opacity:0.85">Founder & Civil Engineer<br><span class="gold" style="font-weight:500">Driving sustainable construction across South Africa</span></p>
    </div>
  </div>

  <!-- Scene 7: CTA -->
  <div class="scene" id="scene7">
    <div class="scene-overlay" style="background:radial-gradient(ellipse at center,rgba(13,33,55,0.5) 0%,#0D2137 70%)"></div>
    <div class="scene-content">
      <div class="crown-logo" id="crownCTA">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 620 510" width="120" height="98">
          <defs><style>.cw2{fill:#ffffff}.cg2{fill:#D4A853}</style></defs>
          <polygon class="cw2" points="172.5 459.5 172.5 457.5 83.5 257.5 172.5 297.5 172.5 263.5 .5 183.5 109.5 463.5 172.5 459.5"/>
          <polygon class="cw2" points="514.5 464.5 619.5 184.5 448.5 263.5 448.5 296.5 537.5 257.5 449.5 458.5 514.5 464.5"/>
          <polygon class="cw2" points="376.5 457.5 431.5 458.5 431.5 207.91 376.5 250.77 376.5 457.5"/>
          <path class="cg2" d="M433.5,181.5c-16-19-33-38-50-57-2-3-4-5-5-8l-2,2v122.74l57-44.42v-15.31h0Z"/>
          <path class="cg2" d="M305.5,56.22c.9-.46,1.92-.72,3-.72s2.1.26,3,.72v235.67l52-40.53V99.5L310.5.5l-54,100v234.26l49-38.19V56.22Z"/>
          <polygon class="cg2" points="243.5 344.89 243.5 117.5 240.5 119.5 188.5 181.5 188.5 387.76 243.5 344.89"/>
          <polygon class="cw2" points="308.5 457.5 363.5 457.5 363.5 260.9 308.5 303.77 308.5 457.5"/>
          <polygon class="cw2" points="188.5 458.5 243.5 457.5 243.5 354.42 188.5 397.29 188.5 458.5"/>
          <polygon class="cw2" points="256.5 457.5 302.5 457.5 302.5 308.44 256.5 344.29 256.5 457.5"/>
          <path class="cw2" d="M516.5,477.5c-16-1-31-3-47-4-105-8-211-5-316,0-15,3-31,1-46,4-1,0-3,1-3,2v30h413c2,0,0-5,0-7,0-4,1-24-1-25Z"/>
        </svg>
      </div>
      <div class="gold-line fade-in" data-anim="fadeIn" data-delay="0.6" data-dur="0.5" style="margin:20px auto"></div>
      <h2 class="serif white fade-up" data-anim="fadeUp" data-delay="0.8" data-dur="0.7" style="font-size:44px;font-weight:700;margin-bottom:12px">Let's Build Together</h2>
      <p class="sans light fade-up" data-anim="fadeUp" data-delay="1.2" data-dur="0.6" style="font-size:18px;letter-spacing:2px;text-transform:uppercase;margin-bottom:50px">Building Tomorrow's Legacy Today</p>
      <div style="display:flex;justify-content:center;gap:60px">
        <div class="cta-item fade-up" data-anim="fadeUp" data-delay="1.4" data-dur="0.5">
          <svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
          <span class="sans white">079 603 7780</span>
        </div>
        <div class="cta-item fade-up" data-anim="fadeUp" data-delay="1.6" data-dur="0.5">
          <svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          <span class="sans white">info@isgcawusomnotho.co.za</span>
        </div>
        <div class="cta-item fade-up" data-anim="fadeUp" data-delay="1.8" data-dur="0.5">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
          <span class="sans white">isgcawusomnotho.co.za</span>
        </div>
      </div>
    </div>
  </div>

  <div class="letterbox-top"></div>
  <div class="letterbox-bottom"></div>
  <div class="progress-bar" id="progressBar" style="width:0%"></div>
  <div class="controls"><span>Space to pause</span></div>
  <div class="play-btn" id="playBtn" onclick="togglePause()">
    <svg viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21"/></svg>
  </div>
</div>

<script>
// ===== TWO-LAYER DEPTH DUST =====
function createDustLayer(canvasId, count, sizeRange, speedRange, opRange) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext('2d');
  const particles = [];

  for (let i = 0; i < count; i++) {
    particles.push({
      x: Math.random() * 1920,
      y: Math.random() * 1080,
      size: sizeRange[0] + Math.random() * (sizeRange[1] - sizeRange[0]),
      vx: (Math.random() - 0.5) * speedRange[0],
      vy: speedRange[1] + Math.random() * speedRange[2],
      opacity: opRange[0] + Math.random() * (opRange[1] - opRange[0]),
      wobbleAmp: Math.random() * 0.6 + 0.1,
      wobbleFreq: Math.random() * 0.015 + 0.003,
      phase: Math.random() * Math.PI * 2,
      isGold: Math.random() < 0.6,
    });
  }

  return { canvas, ctx, particles };
}

const dustFar = createDustLayer('dustFar', 50, [0.5, 1.5], [0.2, 0.05, 0.15], [0.15, 0.35]);
const dustNear = createDustLayer('dustNear', 40, [1.5, 3.5], [0.5, 0.15, 0.35], [0.2, 0.5]);

let dustTick = 0;
function drawDustLayer(layer) {
  const { ctx, particles } = layer;
  ctx.clearRect(0, 0, 1920, 1080);
  dustTick++;
  for (const p of particles) {
    p.x += p.vx + Math.sin(dustTick * p.wobbleFreq + p.phase) * p.wobbleAmp;
    p.y += p.vy;
    if (p.y > 1090) { p.y = -5; p.x = Math.random() * 1920; }
    if (p.x < -10) p.x = 1930;
    if (p.x > 1930) p.x = -10;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    if (p.isGold) {
      ctx.fillStyle = `rgba(212,168,83,${p.opacity})`;
    } else {
      ctx.fillStyle = `rgba(255,255,255,${p.opacity * 0.5})`;
    }
    ctx.fill();
  }
}

// ===== PRELOADER-STYLE CROWN BUILD ANIMATION =====
const crownPieces = document.querySelectorAll('#crownSvg1 [data-build]');
const PIECE_COUNT = crownPieces.length;
const STAGGER = 0.12;        // seconds between each piece
const PIECE_DUR = 0.5;       // each piece anim duration
const BUILD_START = 0.3;     // delay before build starts
const SHIMMER_START = BUILD_START + PIECE_COUNT * STAGGER + PIECE_DUR; // after all built
const GOLD_PULSE_DUR = 0.6;

// back.out(1.4) easing approximation
function backOut(t) {
  const s = 1.4;
  return 1 + (--t) * t * ((s + 1) * t + s);
}

function animateCrownBuild(sceneTime) {
  for (const piece of crownPieces) {
    const order = parseInt(piece.dataset.build);
    const start = BUILD_START + order * STAGGER;
    const t = Math.max(0, Math.min(1, (sceneTime - start) / PIECE_DUR));
    const e = backOut(Math.max(0, Math.min(1, t)));

    piece.style.opacity = t > 0 ? e : 0;
    piece.style.transform = `translateY(${(1 - e) * 30}px) scale(${0.85 + 0.15 * e})`;
    piece.style.transformOrigin = 'center bottom';

    // Gold shimmer pulse after full assembly
    if (piece.dataset.type === 'gold' && sceneTime > SHIMMER_START) {
      const pulseT = (sceneTime - SHIMMER_START) / GOLD_PULSE_DUR;
      if (pulseT < 1) {
        // Pulse to bright gold and back
        const pulse = Math.sin(pulseT * Math.PI);
        const r = Math.round(212 + pulse * 32);
        const g = Math.round(168 + pulse * 40);
        const b = Math.round(83 + pulse * 65);
        piece.style.fill = `rgb(${r},${g},${b})`;
      } else {
        piece.style.fill = '#D4A853';
      }
    }
  }

  // Overall crown scale settle (0.92 → 1.0)
  const svg = document.getElementById('crownSvg1');
  const settleT = Math.max(0, Math.min(1, (sceneTime - BUILD_START) / (PIECE_COUNT * STAGGER + PIECE_DUR)));
  const settleScale = 0.92 + 0.08 * backOut(settleT);
  svg.style.transform = `scale(${settleScale})`;
  svg.style.transformOrigin = 'center center';

  // Crown glow shadow pulses
  if (sceneTime > SHIMMER_START && sceneTime < SHIMMER_START + GOLD_PULSE_DUR) {
    const gp = Math.sin(((sceneTime - SHIMMER_START) / GOLD_PULSE_DUR) * Math.PI);
    svg.style.filter = `drop-shadow(0 0 ${20 + gp * 30}px rgba(212,168,83,${0.3 + gp * 0.4}))`;
  } else if (sceneTime > SHIMMER_START + GOLD_PULSE_DUR) {
    svg.style.filter = `drop-shadow(0 4px 20px rgba(212,168,83,0.3))`;
  }
}

// ===== TIMELINE ENGINE =====
const TOTAL_DURATION = 34;
const scenes = [
  { id: 'scene1', start: 0,   end: 5    },
  { id: 'scene2', start: 4.5, end: 9    },
  { id: 'scene3', start: 8.5, end: 13   },
  { id: 'scene4', start: 12.5,end: 18   },
  { id: 'scene5', start: 17.5,end: 23   },
  { id: 'scene6', start: 22.5,end: 28   },
  { id: 'scene7', start: 27.5,end: 34   },
];

const FADE_DUR = 0.6;
let time = 0, playing = true, lastTimestamp = null;
const progressBar = document.getElementById('progressBar');
const playBtn = document.getElementById('playBtn');

function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }
function easeOutQuart(t) { return 1 - Math.pow(1 - t, 4); }

function animateElement(el, sceneTime) {
  const anim = el.dataset.anim;
  const delay = parseFloat(el.dataset.delay) || 0;
  const dur = parseFloat(el.dataset.dur) || 0.6;
  const t = Math.max(0, Math.min(1, (sceneTime - delay) / dur));
  const e = easeOutCubic(t);
  if (anim === 'fadeUp') {
    el.style.opacity = e;
    el.style.transform = `translateY(${(1 - e) * 40}px)`;
  } else if (anim === 'fadeIn') {
    el.style.opacity = e;
  }
}

function animateCounters(sceneEl, sceneTime) {
  sceneEl.querySelectorAll('[data-counter]').forEach(el => {
    const target = parseInt(el.dataset.counter);
    const prefix = el.dataset.prefix || '';
    const suffix = el.dataset.suffix || '';
    const delay = parseFloat(el.closest('[data-delay]')?.dataset.delay || 0) + 0.3;
    const t = Math.max(0, Math.min(1, (sceneTime - delay) / 1.5));
    el.textContent = prefix + Math.round(target * easeOutQuart(t)) + suffix;
  });
}

function animateKenBurns(bgEl, sceneTime, sceneDuration) {
  if (!bgEl) return;
  const p = sceneTime / sceneDuration;
  bgEl.style.transform = `scale(${1 + p * 0.08}) translateX(${p * -10}px)`;
}

// ===== MAIN LOOP =====
function update(timestamp) {
  if (!lastTimestamp) lastTimestamp = timestamp;
  const dt = (timestamp - lastTimestamp) / 1000;
  lastTimestamp = timestamp;

  // Always draw dust for ambient depth
  drawDustLayer(dustFar);
  drawDustLayer(dustNear);

  if (playing) {
    time += dt;
    if (time >= TOTAL_DURATION) time = 0;
    progressBar.style.width = (time / TOTAL_DURATION * 100) + '%';

    scenes.forEach(s => {
      const el = document.getElementById(s.id);
      const sceneDur = s.end - s.start;
      const sceneTime = time - s.start;

      let opacity = 0;
      if (sceneTime >= 0 && sceneTime <= sceneDur) {
        if (sceneTime < FADE_DUR) opacity = sceneTime / FADE_DUR;
        else if (sceneTime > sceneDur - FADE_DUR) opacity = (sceneDur - sceneTime) / FADE_DUR;
        else opacity = 1;
      }

      el.style.opacity = opacity;
      el.classList.toggle('active', opacity > 0);

      if (opacity > 0) {
        el.querySelectorAll('[data-anim]').forEach(child => animateElement(child, sceneTime));
        animateKenBurns(document.getElementById('bg' + s.id.replace('scene', '')), sceneTime, sceneDur);
        if (s.id === 'scene4') animateCounters(el, sceneTime);
        if (s.id === 'scene1') animateCrownBuild(sceneTime);
      }
    });
  }

  requestAnimationFrame(update);
}

// ===== CONTROLS =====
function togglePause() {
  playing = !playing;
  playBtn.classList.toggle('show', !playing);
}
document.addEventListener('keydown', e => {
  if (e.code === 'Space') { e.preventDefault(); togglePause(); }
});

// ===== AUTO-SCALE =====
function scaleToFit() {
  const vp = document.getElementById('viewport');
  const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
  vp.style.transform = `scale(${scale})`;
}
scaleToFit();
window.addEventListener('resize', scaleToFit);

requestAnimationFrame(update);
</script>
</body>
</html>
